
// SIMULATED OFFLINE TUTOR SERVICE
// No API Keys required. Works 100% offline.

export const initializeGemini = () => {
  // No-op for offline mode
  return null;
};

const SIMULATED_DELAY_MS = 800;

export const askMathTutor = async (userQuestion: string, context: string): Promise<string> => {
  // 1. Simulate "thinking" delay for realism
  await new Promise(resolve => setTimeout(resolve, SIMULATED_DELAY_MS));

  const input = userQuestion.toLowerCase();

  // 2. PEDAGOGICAL KNOWLEDGE BASE
  
  // Greetings
  if (input.match(/(–∑–¥—Ä–∞–≤–æ|–ø–æ–∑–¥—Ä–∞–≤|–µ—ò|hej|zdravo)/)) {
    return "–ó–¥—Ä–∞–≤–æ! üëã –à–∞—Å —Å—É–º —Ç–≤–æ—ò–æ—Ç —É—á–∏—Ç–µ–ª –ø–æ –≥–µ–æ–º–µ—Ç—Ä–∏—ò–∞. –¢—É–∫–∞ —Å—É–º –¥–∞ —Ç–∏ –ø–æ–º–æ–≥–Ω–∞–º —Å–æ —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏—Ü–∏—Ç–µ. –®—Ç–æ —Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å–∏—Ä–∞?";
  }

  // --- LESSON 1: TYPES OF TRIANGLES (Custom Requests) ---

  // Q1: Classification by sides
  // "–ö–∞–∫–≤–∏ –≤–∏–¥–æ–≤–∏ —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏—Ü–∏ –∏–º–∞ —Å–ø–æ—Ä–µ–¥ —Å—Ç—Ä–∞–Ω–∏—Ç–µ?"
  if ((input.includes('–≤–∏–¥–æ–≤–∏') || input.includes('–ø–æ–¥–µ–ª–±–∞')) && (input.includes('—Å—Ç—Ä–∞–Ω–∏') || input.includes('—Å—Ç—Ä–∞–Ω–∏—Ç–µ'))) {
    return "–°–ø–æ—Ä–µ–¥ —Å—Ç—Ä–∞–Ω–∏—Ç–µ, —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏—Ü–∏—Ç–µ —Å–µ –¥–µ–ª–∞—Ç –Ω–∞ —Ä–∞–º–Ω–æ—Å—Ç—Ä–∞–Ω, —Ä–∞–º–Ω–æ–∫—Ä–∞–∫ –∏ —Ä–∞–∑–Ω–æ—Å—Ç—Ä–∞–Ω.\n\n–û–±–∏–¥–∏ —Å–µ —Å–æ –≤–ª–µ—á–µ—ö–µ –Ω–∞ —Ç–µ–º–∏—ö–∞—Ç–∞ –¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—à —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫ —Å–æ –µ–¥–Ω–∞–∫–≤–∏ –∏–ª–∏ —Ä–∞–∑–ª–∏—á–Ω–∏ —Å—Ç—Ä–∞–Ω–∏.";
  }

  // Q4: Classification by angles
  // "–ö–∞–∫–≤–∏ –≤–∏–¥–æ–≤–∏ —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏—Ü–∏ –∏–º–∞ —Å–ø–æ—Ä–µ–¥ –∞–≥–ª–∏—Ç–µ?"
  if ((input.includes('–≤–∏–¥–æ–≤–∏') || input.includes('–ø–æ–¥–µ–ª–±–∞')) && (input.includes('–∞–≥–ª–∏') || input.includes('–∞–≥–ª–∏—Ç–µ'))) {
    return "–°–ø–æ—Ä–µ–¥ –∞–≥–ª–∏—Ç–µ, —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏—Ü–∏—Ç–µ —Å–µ –¥–µ–ª–∞—Ç –Ω–∞ –æ—Å—Ç—Ä–æ–∞–≥–æ–ª–µ–Ω, –ø—Ä–∞–≤–æ–∞–≥–æ–ª–µ–Ω –∏ —Ç—É–ø–æ–∞–≥–æ–ª–µ–Ω —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫.\n\n–ü—Ä–æ–º–µ–Ω–∏ —ò–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –Ω–∞ —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫–æ—Ç –∏ –Ω–∞–±—ô—É–¥—É–≤–∞—ò –∫–∞–∫–æ —Å–µ –º–µ–Ω—É–≤–∞–∞—Ç –∞–≥–ª–∏—Ç–µ.";
  }

  // Q2: Equilateral Triangle
  // "–®—Ç–æ –µ —Ä–∞–º–Ω–æ—Å—Ç—Ä–∞–Ω —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫?"
  if (input.includes('—Ä–∞–º–Ω–æ—Å—Ç—Ä–∞–Ω')) {
    return "–†–∞–º–Ω–æ—Å—Ç—Ä–∞–Ω —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫ –µ —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫ –∫–∞—ò –∫–æ—ò —Å–∏—Ç–µ —Ç—Ä–∏ —Å—Ç—Ä–∞–Ω–∏ —Å–µ –µ–¥–Ω–∞–∫–≤–∏, –∞ –∏ —Å–∏—Ç–µ —Ç—Ä–∏ –∞–≥–ª–∏ —Å–µ –µ–¥–Ω–∞–∫–≤–∏.\n\n–ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ –º–æ–∂–µ—à –¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—à —Ç–∞–∫–æ–≤ —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫ –Ω–∞ —Ü—Ä—Ç–µ–∂–æ—Ç.";
  }

  // Q3: Isosceles Triangle
  // "–®—Ç–æ –µ —Ä–∞–º–Ω–æ–∫—Ä–∞–∫ —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫?"
  if (input.includes('—Ä–∞–º–Ω–æ–∫—Ä–∞–∫')) {
    return "–†–∞–º–Ω–æ–∫—Ä–∞–∫ —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫ –∏–º–∞ –¥–≤–µ –µ–¥–Ω–∞–∫–≤–∏ —Å—Ç—Ä–∞–Ω–∏ –∏ –¥–≤–∞ –µ–¥–Ω–∞–∫–≤–∏ –∞–≥–ª–∏.\n\n–ü–æ–≤–ª–µ—á–∏ –≥–∏ —Ç–µ–º–∏—ö–∞—Ç–∞ –∏ –∑–∞–±–µ–ª–µ–∂–∏ –∫–æ–∏ –∞–≥–ª–∏ —Å—Ç–∞–Ω—É–≤–∞–∞—Ç –µ–¥–Ω–∞–∫–≤–∏.";
  }

  // Q5: Right Triangle Recognition
  // "–ö–∞–∫–æ —ú–µ –ø—Ä–µ–ø–æ–∑–Ω–∞–∞–º –¥–∞–ª–∏ —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫–æ—Ç –µ –ø—Ä–∞–≤–æ–∞–≥–æ–ª–µ–Ω?"
  // Also handles general questions about right triangles
  if (input.includes('–ø—Ä–∞–≤–æ–∞–≥–æ–ª–µ–Ω')) {
    return "–¢—Ä–∏–∞–≥–æ–ª–Ω–∏–∫–æ—Ç –µ –ø—Ä–∞–≤–æ–∞–≥–æ–ª–µ–Ω –∞–∫–æ –µ–¥–µ–Ω –æ–¥ –Ω–µ–≥–æ–≤–∏—Ç–µ –∞–≥–ª–∏ –µ 90¬∞.\n\n–û–±–∏–¥–∏ —Å–µ –¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—à –∞–≥–æ–ª –æ–¥ 90¬∞ —Å–æ –≤–ª–µ—á–µ—ö–µ –Ω–∞ —Ç–µ–º–∏—ö–∞—Ç–∞.";
  }

  // --- OTHER TOPICS ---

  // Scalene (General)
  if (input.includes('—Ä–∞–∑–Ω–æ—Å—Ç—Ä–∞–Ω')) {
    return "–ö–∞—ò —Ä–∞–∑–Ω–æ—Å—Ç—Ä–∞–Ω —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫, —Å–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏ –∏ —Å–∏—Ç–µ –∞–≥–ª–∏ —Å–µ —Ä–∞–∑–ª–∏—á–Ω–∏. –¢—É–∫–∞ –≤–∞–∂–∏ –ø—Ä–∞–≤–∏–ª–æ—Ç–æ: –ù–∞—Å–ø—Ä–æ—Ç–∏ –ø–æ–≥–æ–ª–µ–º–∞ —Å—Ç—Ä–∞–Ω–∞ –ª–µ–∂–∏ –ø–æ–≥–æ–ª–µ–º –∞–≥–æ–ª.";
  }

  // Acute
  if (input.includes('–æ—Å—Ç—Ä–æ–∞–≥–æ–ª–µ–Ω')) {
    return "–ö–∞—ò –æ—Å—Ç—Ä–æ–∞–≥–æ–ª–µ–Ω —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫, —Å–∏—Ç–µ —Ç—Ä–∏ –∞–≥–ª–∏ —Å–µ –ø–æ–º–∞–ª–∏ –æ–¥ 90 —Å—Ç–µ–ø–µ–Ω–∏.";
  }

  // Obtuse
  if (input.includes('—Ç–∞–ø–æ–∞–≥–æ–ª–µ–Ω') || input.includes('—Ç—É–ø–æ–∞–≥–æ–ª–µ–Ω')) {
    return "–¢–∞–ø–æ–∞–≥–æ–ª–µ–Ω (—Ç—É–ø–æ–∞–≥–æ–ª–µ–Ω) —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫ –∏–º–∞ –µ–¥–µ–Ω –∞–≥–æ–ª —à—Ç–æ –µ –ø–æ–≥–æ–ª–µ–º –æ–¥ 90 —Å—Ç–µ–ø–µ–Ω–∏. –î—Ä—É–≥–∏—Ç–µ –¥–≤–∞ –º–æ—Ä–∞ –¥–∞ –±–∏–¥–∞—Ç –æ—Å—Ç—Ä–∏.";
  }

  // Interior Angles (Sum 180)
  if (input.includes('180') || (input.includes('–∑–±–∏—Ä') && input.includes('–≤–Ω–∞—Ç—Ä–µ'))) {
    return "–¢–æ—á–Ω–æ! –ó–±–∏—Ä–æ—Ç –Ω–∞ –≤–Ω–∞—Ç—Ä–µ—à–Ω–∏—Ç–µ –∞–≥–ª–∏ –≤–æ —Å–µ–∫–æ—ò —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫ –µ **180 —Å—Ç–µ–ø–µ–Ω–∏**. $\\alpha + \\beta + \\gamma = 180^{\\circ}$. –î–∞–ª–∏ –∑–Ω–∞–µ—à –∫–∞–∫–æ –≥–æ –¥–æ–∫–∞–∂—É–≤–∞–º–µ –æ–≤–∞?";
  }

  // Exterior Angles
  if (input.includes('–Ω–∞–¥–≤–æ—Ä–µ—à')) {
    return "–ù–∞–¥–≤–æ—Ä–µ—à–Ω–∏—Ç–µ –∞–≥–ª–∏ —Å–µ –º–Ω–æ–≥—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∏! \n\n1. –ó–±–∏—Ä–æ—Ç –Ω–∞ —Å–∏—Ç–µ –Ω–∞–¥–≤–æ—Ä–µ—à–Ω–∏ –∞–≥–ª–∏ –µ —Å–µ–∫–æ–≥–∞—à **360¬∞**.\n2. –ï–¥–µ–Ω –Ω–∞–¥–≤–æ—Ä–µ—à–µ–Ω –∞–≥–æ–ª –µ –µ–¥–Ω–∞–∫–æ–≤ –Ω–∞ –∑–±–∏—Ä–æ—Ç –Ω–∞ –¥–≤–∞—Ç–∞ –≤–Ω–∞—Ç—Ä–µ—à–Ω–∏ –Ω–µ—Å–æ—Å–µ–¥–Ω–∏ –∞–≥–ª–∏.";
  }

  // Points and Lines
  if (input.includes('–≤–∏—Å–∏–Ω')) {
    return "–í–∏—Å–∏–Ω–∞ –µ –æ—Ç—Å–µ—á–∫–∞ —Å–ø—É—à—Ç–µ–Ω–∞ –æ–¥ —Ç–µ–º–µ—Ç–æ –Ω–æ—Ä–º–∞–ª–Ω–æ –Ω–∞ —Å–ø—Ä–æ—Ç–∏–≤–Ω–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∞ (–ø—Ä–∞–≤–∏ –ø—Ä–∞–≤ –∞–≥–æ–ª). –¢—Ä–∏—Ç–µ –≤–∏—Å–∏–Ω–∏ —Å–µ —Å–µ—á–∞—Ç –≤–æ **–û—Ä—Ç–æ—Ü–µ–Ω—Ç–∞—Ä**.";
  }
  if (input.includes('—Ç–µ–∂–∏—à')) {
    return "–¢–µ–∂–∏—à–Ω–∞ –ª–∏–Ω–∏—ò–∞ –≥–æ –ø–æ–≤—Ä–∑—É–≤–∞ —Ç–µ–º–µ—Ç–æ —Å–æ —Å—Ä–µ–¥–∏–Ω–∞—Ç–∞ –Ω–∞ —Å–ø—Ä–æ—Ç–∏–≤–Ω–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∞. –¢—Ä–∏—Ç–µ —Ç–µ–∂–∏—à–Ω–∏ –ª–∏–Ω–∏–∏ —Å–µ —Å–µ—á–∞—Ç –≤–æ **–¢–µ–∂–∏—à—Ç–µ**. –¢–æ–∞ –µ —Ü–µ–Ω—Ç–∞—Ä–æ—Ç –Ω–∞ —Ä–∞–º–Ω–æ—Ç–µ–∂–∞!";
  }
  if (input.includes('—Å—Ä–µ–¥–Ω–∞ –ª–∏–Ω–∏—ò–∞')) {
    return "–°—Ä–µ–¥–Ω–∞ –ª–∏–Ω–∏—ò–∞ –≥–∏ –ø–æ–≤—Ä–∑—É–≤–∞ —Å—Ä–µ–¥–∏–Ω–∏—Ç–µ –Ω–∞ –¥–≤–µ —Å—Ç—Ä–∞–Ω–∏. –¢–∞–∞ –µ –ø–∞—Ä–∞–ª–µ–ª–Ω–∞ —Å–æ —Ç—Ä–µ—Ç–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∞ –∏ –µ –¥–≤–æ—ò–Ω–æ –ø–æ–º–∞–ª–∞ –æ–¥ –Ω–µ–∞.";
  }
  if (input.includes('–æ–ø–∏—à–∞–Ω–∞')) {
    return "–û–ø–∏—à–∞–Ω–∞ –∫—Ä—É–∂–Ω–∏—Ü–∞ –ø–æ–º–∏–Ω—É–≤–∞ –Ω–∏–∑ —Å–∏—Ç–µ —Ç–µ–º–∏—ö–∞. –ù–µ—ò–∑–∏–Ω–∏–æ—Ç —Ü–µ–Ω—Ç–∞—Ä –µ –ø—Ä–µ—Å–µ–∫–æ—Ç –Ω–∞ —Å–∏–º–µ—Ç—Ä–∞–ª–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ç–µ.";
  }
  if (input.includes('–≤–ø–∏—à–∞–Ω–∞')) {
    return "–í–ø–∏—à–∞–Ω–∞ –∫—Ä—É–∂–Ω–∏—Ü–∞ –µ –≤–Ω–∞—Ç—Ä–µ –≤–æ —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫–æ—Ç –∏ –≥–∏ –¥–æ–ø–∏—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ç–µ. –¶–µ–Ω—Ç–∞—Ä–æ—Ç –µ –ø—Ä–µ—Å–µ–∫ –Ω–∞ —Å–∏–º–µ—Ç—Ä–∞–ª–∏—Ç–µ –Ω–∞ –∞–≥–ª–∏—Ç–µ.";
  }

  // Existence / Inequality
  if (input.includes('–ø–æ—Å—Ç–æ–∏') || input.includes('–µ–≥–∑–∏—Å—Ç–µ–Ω—Ü–∏—ò–∞') || (input.includes('—Å—Ç—Ä–∞–Ω–∏') && input.includes('–∑–±–∏—Ä'))) {
    return "–ó–∞ –¥–∞ –ø–æ—Å—Ç–æ–∏ —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫, –º–æ—Ä–∞ –¥–∞ –≤–∞–∂–∏: **–ó–±–∏—Ä–æ—Ç –Ω–∞ –±–∏–ª–æ –∫–æ–∏ –¥–≤–µ —Å—Ç—Ä–∞–Ω–∏ –¥–∞ –µ –ø–æ–≥–æ–ª–µ–º –æ–¥ —Ç—Ä–µ—Ç–∞—Ç–∞**. ($a+b>c$). –ê–∫–æ –Ω–µ –≤–∞–∂–∏, —Å—Ç—Ä–∞–Ω–∏—Ç–µ –Ω–µ–º–∞ –¥–∞ —Å–µ —Å–ø–æ—ò–∞—Ç!";
  }

  // 3. CONTEXT-AWARE FALLBACKS
  // If no keyword matched, give a hint based on the current Lesson/Module
  
  if (context.includes('INTERNAL_ANGLES')) {
    return "–ú–æ–º–µ–Ω—Ç–∞–ª–Ω–æ —É—á–∏–º–µ –∑–∞ –∞–≥–ª–∏. –ó–∞–ø–∞–º–µ—Ç–∏: $\\alpha + \\beta + \\gamma = 180^{\\circ}$. –û–±–∏–¥–∏ —Å–µ –¥–∞ –ø—Ä–µ—Å–º–µ—Ç–∞—à —Ç—Ä–µ—Ç –∞–≥–æ–ª –∞–∫–æ –∑–Ω–∞–µ—à –¥–≤–∞!";
  }
  if (context.includes('EXTERNAL_ANGLES')) {
    return "–ì–ª–µ–¥–∞–º –¥–µ–∫–∞ –∏—Å—Ç—Ä–∞–∂—É–≤–∞—à –Ω–∞–¥–≤–æ—Ä–µ—à–Ω–∏ –∞–≥–ª–∏. –î–∞–ª–∏ –∑–Ω–∞–µ—à –¥–µ–∫–∞ –≤–Ω–∞—Ç—Ä–µ—à–µ–Ω + –Ω–∞–¥–≤–æ—Ä–µ—à–µ–Ω –∞–≥–æ–ª –ø—Ä–∞–≤–∞—Ç 180 —Å—Ç–µ–ø–µ–Ω–∏?";
  }
  if (context.includes('TYPES')) {
    return "–ó–±–æ—Ä—É–≤–∞–º–µ –∑–∞ –≤–∏–¥–æ–≤–∏ —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏—Ü–∏? –ú–æ–∂–µ–º–µ –¥–∞ –≥–∏ –¥–µ–ª–∏–º–µ —Å–ø–æ—Ä–µ–¥ —Å—Ç—Ä–∞–Ω–∏ (–∫–∞–∫–æ —Ä–∞–º–Ω–æ—Å—Ç—Ä–∞–Ω) –∏–ª–∏ –∞–≥–ª–∏ (–∫–∞–∫–æ –ø—Ä–∞–≤–æ–∞–≥–æ–ª–µ–Ω).";
  }
  if (context.includes('EXISTENCE')) {
    return "–ü—Ä–æ–≤–µ—Ä—É–≤–∞—à –¥–∞–ª–∏ —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏–∫ –ø–æ—Å—Ç–æ–∏? –°–∞–º–æ —Å–æ–±–µ—Ä–∏ –≥–∏ –¥–≤–µ—Ç–µ –ø–æ–∫—Ä–∞—Ç–∫–∏ —Å—Ç—Ä–∞–Ω–∏ - –Ω–∏–≤–Ω–∏–æ—Ç –∑–±–∏—Ä –º–æ—Ä–∞ –¥–∞ –µ –ø–æ–≥–æ–ª–µ–º –æ–¥ –Ω–∞—ò–¥–æ–ª–≥–∞—Ç–∞!";
  }
  if (context.includes('CENTROID')) {
    return "–¢–µ–∂–∏—à—Ç–µ—Ç–æ –µ –º–∞–≥–∏—á–Ω–∞ —Ç–æ—á–∫–∞! –à–∞ –¥–µ–ª–∏ —Ç–µ–∂–∏—à–Ω–∞—Ç–∞ –ª–∏–Ω–∏—ò–∞ –≤–æ —Å–æ–æ–¥–Ω–æ—Å 2:1. –î–∞–ª–∏ –≥–æ –≤–∏–¥–µ —Ç–æ–∞ –≤–æ –∞–Ω–∏–º–∞—Ü–∏—ò–∞—Ç–∞?";
  }

  // 4. GENERIC FALLBACK
  return "–¢–æ–∞ –µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –ø—Ä–∞—à–∞—ö–µ! ü§î –ú–æ–∂–µ—à –ª–∏ –¥–∞ –±–∏–¥–µ—à –º–∞–ª–∫—É –ø–æ–ø—Ä–µ—Ü–∏–∑–µ–Ω? –ü—Ä–∞—à–∞—ò –º–µ –∑–∞:\n- –í–∏–¥–æ–≤–∏ —Ç—Ä–∏–∞–≥–æ–ª–Ω–∏—Ü–∏ (—Å–ø–æ—Ä–µ–¥ —Å—Ç—Ä–∞–Ω–∏ –∏–ª–∏ –∞–≥–ª–∏)\n- –ó–±–∏—Ä –Ω–∞ –∞–≥–ª–∏\n- –í–∏—Å–∏–Ω–∏ –∏ —Ç–µ–∂–∏—à–Ω–∏ –ª–∏–Ω–∏–∏";
};
